<!DOCTYPE html>
<html>
<head>
<title>#iotmark</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="apple-mobile-web-app-capable" content="yes">

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,700,300" rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="css/common.css" type="text/css" />
<link media="handheld, only screen and (max-width: 720px), only screen and (max-device-width: 854px)" href="css/mobile.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<section id="header">
    <img id="logo" src="images/logo.svg" class="go-forward">
    #iotmark
</section>
<screen>
    <section id="question">
        <h1>Do you allow users to access their collected data, free of charge?</h1>
        <div class="assessment">Assessment: The vendor submits a link to public documentation explaining how to export collected data, and a link to the respective section in terms & conditions</div>
        <div class="options">
          <div class="option">Done</div>
          <div class="option">Planning</div>
          <div class="option">Undecided</div>
          <div class="option">Decided against</div>
          <div class="option">Don’t know what you mean</div>
        </div>
    </section>
    <section id="controls">
        <div class="progress-counter"></div>
        <div class="go-back"></div>
    </section>
</screen>
<section id="footer" style="position: fixed; bottom: 0px;">
    <div id="copyright"></div>
    <div id="progress">
        <div id="progress-indicator-bg"></div>
        <div id="progress-indicator">
            <img src="images/doge.png">
        </div>
        <span class="progress-section">interoperability</span>
        <span class="progress-section">openness</span>
        <span class="progress-section">ownership</span>
        <span class="progress-section">transparency</span>
        <span class="progress-section">privacy</span>
        <span class="progress-section">security</span>
        <span class="progress-section">lifecycle</span>
        <span class="progress-section"></span>
    </div>
</section>
</body>
<script src="scripts/utils/jquery-3.3.1.min.js"></script>
<script>

var generic_options = [ "Done", "Planning", "Undecided", "Decided against", "Don't know what you mean" ];
var survey = [
{
  "name": "The open #iotmark assessment form",
  "note": "Try our easy form to assess how your you’re doing on your journey to make a good, secure and ethical connected product. This will take you about 15 minutes.<br><br> We assume that your team or company makes and sells connected products that have a software and hardware component. Check out our definitions for some of the terms we use <a href='https://github.com/openiotmark/iotmark-principles#roles' target='_blank'>here</a>.",
  "questions": [{
    "multi": true,
    "submit_label": "Get started",
    "subquestions": []
  }]
},

{
  "name": "Interoperability",
  "note": "Interoperability is about making it technically possible to use devices, backends and clients of the vendor with those of a third party. Interoperability does not imply unrestricted access to user data.",
  "questions": [
    {
      "question": "Do you allow third parties to connect clients to its backend?",
      "assessment": "The vendor submits a link to public documentation of the client-specific backend API.",
      "options": generic_options
    },
    {
      "question": "Do you grant third party clients the same functional scope on the backend as its own clients?",
      "assessment": "The assessor collects complaints, including screenshots or video \"proof\", filed by users or third parties.",
      "options": generic_options
    },
    {
      "question": "Do you allow third parties to connect devices to its backend?",
      "assessment": "The vendor submits a link to public documentation of the device-specific backend API.",
      "options": generic_options
    },
    {
      "question": "Do you allow third parties to communicate directly with its devices, without going through the backend?",
      "assessment": "The vendor submits a link to public documentation of the device communication interface.",
      "options": generic_options
    }
  ]
},

{
  "name": "Openness",
  "note": "Openness is about open source, which is considered a simple way to reduce dependencies between a vendor and a user and build trust between them. Openness does not imply unrestricted access to user data.",
  "questions": [
    {
      "question": "Have you published the device firmware source code under an open source license?",
      "assessment": "The vendor submits a link to a public source code repository or ZIP file. The source code is licensed with MIT License or Apache 2 or GPLv3 or at least a license compliant with the Open Source Definition.",
      "options": generic_options
    },
    {
      "question": "Have you published the device hardware designs under an open hardware license?",
      "assessment": "The vendor submits a link to a public repository or ZIP file. Hardware design files may include but are not limited to schema files, PCB layouts, and any other materials that would support the recreation of the product by the user or a third party. The license is compliant with the Open Source Hardware Definition.",
      "options": generic_options
    },
    {
      "question": "Have you published the backend source code under an open source license?",
      "assessment": "The vendor submits a link to a public repository or ZIP file. The source code is licensed with Apache 2 or AGPLv3 or at least a license compliant with the Open Source Definition.",
      "options": generic_options
    },
    {
      "question": "Have you published client source code under an open source license?",
      "assessment": "The vendor submits a link to a public source code repository or ZIP file. The source code is licensed with MIT License or Apache 2 or GPLv3 or at least a license compliant with the Open Source Definition.",
      "options": generic_options
    }
  ]
},

{
  "name": "Ownership",
  "note": "",
  "questions": [
    {
      "question": "Do you allow users to turn off the connection from the device to the backend?",
      "assessment": "The vendor submits a link to user documentation explaining how to turn off the connection from the device to the backend.",
      "options": generic_options
    },
    {
      "question": "Do you allow users to transfer ownership of the device?",
      "assessment": "The vendor submits a link to public user documentation explaining how to transfer ownership of a device to another user.",
      "options": generic_options
    },
    {
      "question": "Do you prevent new user from accessing previous user's data when ownership of the device is transferred?",
      "assessment": "The vendor submits a link to video proof. The assessor collects user complaints.",
      "options": generic_options
    }
  ]
},

{
  "name": "Transparency",
  "note": "",
  "questions": [
    {
      "question": "Do you make explicit the legal implications of substantially changing device usage?",
      "assessment": "The vendor submits a link to public user documentation explaining the (secondary) legal implications of changing how the device is used, or taking it offline.",
      "options": generic_options
    },
    {
      "question": "Do you make explicit the expected duration of the terms of service?",
      "assessment": "The vendor submits a link to the terms of service which have to include a \"best before\" expiration date.",
      "options": generic_options
    },
    {
      "question": "Do you ask permission from users before changing the terms of service?",
      "assessment": "The vendor submits proof that terms & conditions changes are communicated to users and their permission is sought explicitly.",
      "options": generic_options
    },
    {
      "question": "Do you inform users about substantial firmware upgrades?",
      "assessment": "The vendor submits a link to a blog or feed or other public, auditable trail of firmware revisions.",
      "options": generic_options
    }
  ]
},

{
  "name": "privacy",
  "note": "What does GDPR compliance mean for IoT? Connected products often collect data through device sensors or by logging user commands. The distinction between personal user data and environmental data becomes fluent. All data is assumed to be personal.",
  "questions": [
    {
      "question": "Do you allow users to access their collected data, free of charge?",
      "assessment": "The vendor submits a link to public documentation explaining how to export collected data, and a link to the respective section in terms and conditions.",
      "options": generic_options
    },
    {
      "question": "Do you make clear to users how the collected data is used?",
      "assessment": "The vendor submits a link to its public privacy policy explaining how the collected data is used.",
      "options": generic_options
    },
    {
      "question": "Do you allow users to delete their collected data?",
      "assessment": "The vendor submits a link to public documentation explaining how to delete collected data, to \"be forgotten\".",
      "options": generic_options
    },
    {
      "question": "Do you allow users to migrate their collected data to another backend?",
      "assessment": "The vendor submits a link to public documentation explaining how to export collected data, and a link to the respective section in terms & conditions.",
      "options": generic_options
    },
    {
      "question": "Do you allow users to easily opt out of direct marketing based on their collected data?",
      "assessment": "The vendor submits a link to public documentation explaining how to opt out of direct marketing based on the collected data.",
      "options": generic_options
    },
    {
      "question": "Do you allow users to restrict the use of their collected data?",
      "assessment": "The vendor submits a link to public documentation explaining how to restrict the use of the collected data.",
      "options": generic_options
    },
    {
      "question": "Do you allow users to update their collected data?",
      "assessment": "The vendor submits a link to public documentation explaining how to update the collected data.",
      "options": generic_options
    },
    {
      "question": "Do you allow users to stop automated decisions being made, if there are personal legal or significant consequences?",
      "assessment": "The vendor submits a link to public documentation explaining how to stop automated decisions and get a human to re-evaluate the decision.",
      "options": generic_options
    }
  ]
},

{
  "name": "Security",
  "note": "",
  "questions": [
    {
      "question": "Have you implemented 'security by design' for the connected product?",
      "assessment": "Define security requirements, strong crypto, provide security support via OTA update (see 5), integrate the security of dependencies (see 5), secure firmware.",
      "options": generic_options
    },
    {
      "question": "Have you implemented 'security by default' for the connected product?",
      "assessment": "Users need to change the password at first run, no unencrypted communication, no unneeded open service.",
      "options": generic_options
    },
    {
      "question": "Have you assessed the risk of well known IoT threats on the connected product?",
      "assessment": "The vendor submits a risk assessment of the security of the device and its backend (OWASP Top 10, secure backend).",
      "options": generic_options
    }
  ]
},

{
  "name": "Lifecycle",
  "note": "",
  "questions": [
    {
      "question": "Do you allow users to factory reset the device?",
      "assessment": "The vendor submits a link to public user documentation showing how to factory reset the device.",
      "options": generic_options
    },
    {
      "question": "Do you actively avoid degrading or changing the core functionality of the connected product over its lifetime?",
      "assessment": "Core functionality is declared once by the vendor and backed by submitting a link to public marketing materials. Compliance with the principle can be verified on audit or by users at any time by comparing the current functionality with the declared core functionality.",
      "options": generic_options
    },
    {
      "question": "Do you offer documentation for any parts that a user can repair using common tools and skills?",
      "assessment": "The vendor submits a link to public user documentation including a visual overview of how repairs can be done. Design files should be made available if the piece is expected to be 3D-printed.",
      "options": generic_options
    },
    {
      "question": "Do you supply spare parts on request during the lifecycle of the product?",
      "assessment": "A clear and accessible form that a user can fill in to request these parts should be included as part of the packaging or online presence of the vendor.",
      "options": generic_options
    }
  ]
},

{
  "name": "Thanks for filling in the assessment form",
  "note": "It looks like you have XX questions which you’re not sure about. If you’d like to get some help with these, open #iotmark offers a free 1h consultancy call with a one of our community members who is best placed to help you. After that, you’re free to work with them on a consultancy basis.<br><br> Tell us a little about yourself and we’ll put you in touch with the right person.",
  "questions": [{
    "multi": true,
    "submit_label": "Let's go with it",
    "subquestions": []
  }]
},

{
  "name": "Almost there",
  "note": "",
  "questions": [{
    "multi": true,
    "submit_label": "All done",
    "subquestions": [
      { "question": "Full Name" },
      { "question": "Role", "options": [ "Technical", "Marketing", "Business Development", "Product Design", "Other" ]},
      { "question": "Company name" },
      { "question": "URL" },
      { "question": "Email" }
    ]
  }]
}

/*{
  "name": "About your product",
  "standalone": true,
  "questions": [{
    "multi": true,
    "subquestions": [
      { "question": "Product website or shop URL" },
      {
        "question": "Which of these do you provide?",
        "assessment": "We use these definitions https://github.com/openiotmark/iotmark-principles#definitions",
        "options": [ "Device", "Gateway", "Backend", "Client", "Other" ]
      },
      {
        "question": "Which of these do you outsource?",
        "assessment": "We use these definitions https://github.com/openiotmark/iotmark-principles#definitions",
        "options": [ "Device", "Gateway", "Backend", "Client", "Other" ]
      },
      { "question": "How does your connected product work?" }
    ]
  }]
},*/

];

var survey_iter = -1;
var is_multi = true;
var N_SKIP_FIRST_SECTIONS = 1;
var N_SKIP_LAST_SECTIONS = 2;

function renderQuestion(s, question_idx) {
    var q = s.questions[question_idx];
    var view = $("section#question");
    view.empty();

    if(q.multi) {
        is_multi = true;
        view.append("<h1>"+s.name+"</h1>");
        if(s.note) view.append("<div class='note'>"+s.note+"</div>");
        for(var i = 0; i < q.subquestions.length; i++) {
            var qq = q.subquestions[i];
            view.append("<h2>"+qq.question+"</h2>");
            var options = $("<div class='options'></div><br>");
            if(qq.options) {
                for(var j = 0; j < qq.options.length; j++) {
                    options.append("<div class='option'>" + qq.options[j] + "</div>");
                }
            } else {
                options.append("<input class='option' type='text'>");
            }
            view.append(options);
        }
        view.append("<div class='option go-forward'>"+q.submit_label+"</div>");
        $("div.progress-counter").html("");
    } else {
        is_multi = false;
        $("div.progress-counter").html(question_idx+1 + " of " + s.questions.length);
        view.append("<h1>" +q.question+"</h1>");
        if(q.assessment) view.append("<div class='assessment'>"+q.assessment+"</div>");
        
        var options = $("<div class='options'></div>");
        if(q.options) {
            for(var i = 0; i < q.options.length; i++) {
                options.append("<div class='option'>" + q.options[i] + "</div>");
            }
            view.append(options);
        } else {
            options.html("<input class='option' type='text'>");
        }
        view.append(options);
    }
}

function locateSurvey(iter) {
    var counter = 0;
    for(var i = 0; i < survey.length; i++) {
        if(counter + survey[i].questions.length > iter) {
            return { "s": i, "q": iter - counter };
        }
        counter += survey[i].questions.length;
    }
    return { "s": -1, "q": -1 }; // END OF SURVEY
}

function iterateSurvey() {
    var sq_iter = locateSurvey(++survey_iter);
    $("span.progress-section").removeClass("active");

    if(sq_iter.s == 0) {
        $("section#controls").css("display", "none");
    }
    if(sq_iter.s >= survey.length-N_SKIP_LAST_SECTIONS || sq_iter.s == -1) {
        $("div#progress-indicator > img").css("display", "none");
        $("section#controls").css("display", "none");
    }
    if(sq_iter.s == -1) { // survey ended
        $("div#progress-indicator").css("width", "100%");
        var view = $("section#question");
        view.empty();
        view.append("<h1>Thanks! We will contact you soon!</h1>");
        view.append("<div class='note'>For now, feel free to check additional resources <a href='https://github.com/openiotmark/iotmark-principles/wiki'>here</a>.</div>");
        return;
    }

    console.log(sq_iter);
    var s = survey[sq_iter.s];
    renderQuestion(s, sq_iter.q);

    // let's show the progress //
    var part = Math.max(0,sq_iter.s-N_SKIP_FIRST_SECTIONS);

    var section_offset = $("span.progress-section:nth("+part+")").position().left;
    var ratio = section_offset / $("div#progress").width();
    
    var ratio_next = 1;
    if(part < survey.length-1-N_SKIP_LAST_SECTIONS) {
      var section_next = $("span.progress-section:nth("+(part+1)+")").position().left;
      ratio_next = section_next / $("div#progress").width();
      if(sq_iter.s > (N_SKIP_FIRST_SECTIONS-1)) $("span.progress-section:nth("+part+")").addClass("active");
    }
    
    var delta = (ratio_next - ratio) * (sq_iter.q / s.questions.length);
    $("div#progress-indicator").css("width", (ratio+delta)*100+"%");
}

$(document).ready(function() {
    $(document).on("click", "div.option", function() {
        $(this).parent().children().removeClass("checked");
        $(this).addClass("checked");
        if(!is_multi) iterateSurvey();
    });
    $(document).on("click", ".go-forward", function() {
        $("section#controls").css("display", "inline-block");
        iterateSurvey();
    });
    $(document).on("click", ".go-back", function() {
        if(survey_iter > 0) {
          survey_iter -= 2;
          iterateSurvey();
        }
    });
    iterateSurvey();
});

</script>
</html>
